<div class="o_videotask_layer">
	<div id="o_videotask_messages" class="o_videotask_messages #if($r.isNotEmpty($message)) show #else hide #end">
		<span>$message</span>
	</div>
	#if($r.isTrue($enableDisableCategories))
	<div id="o_videotask_start_message" class="o_videotask_messages hide">
		<span>$r.translate("feedback.start.segment")</span>
	</div>
	#end
	<div id="o_videotask_categories" class="o_videotask_categories">
	#foreach ($category in $categories)
		<button class="btn btn-default $category.color" href="javascript:;" role="button" onclick="$f.openFfXHREvent(false, false, true),'cid','category','category-id','${category.id}','position',jQuery('#o_so_vid${videoElementId}').data('player').media.currentTime);">
			#if($r.isNotEmpty($category.iconCssClass)) <i class="o_icon $category.iconCssClass"> </i> #end${category.title}</button>
	#end
	</div>
	<div id="o_videotask_segments" class="o_videotask_segments $segmentsCssClass">
		#foreach ($segment in $segments)
		<div class="o_video_me_segment o_video_me_colored_area ${segment.color()}" style="left: ${segment.left()}; width: ${segment.width()};" data-index="${foreach.count}" data-start="${segment.start()}" data-duration="${segment.duration()}">
			${segment.label()}
		</div>
		#end
		#foreach ($segmentMarker in $segmentsSelections)
			#if(${segmentMarker.visible()})
			<div data-label-title="${segmentMarker.getCategoryLabelAndTitle()}" data-duration-string="${segmentMarker.durationString()}" data-category-color="${segmentMarker.categoryColor}" class="o_vt_marker ${segmentMarker.resultCssClass()} ${segmentMarker.categoryColor}" style="#if($r.isNotEmpty($segmentMarker.width())) width: ${segmentMarker.width()}; #end left: ${segmentMarker.left()};">
				<span>${segmentMarker.categoryLabel}</span>
			</div>
			#end
		#end
	</div>
	
	#if($r.isTrue($showTooltips))
	<script>
	"use strict";
	jQuery(function() {
		jQuery('#o_videotask_segments>.o_vt_marker').each(function(index, el) {
			const jEl = jQuery(el);
			const title = '<strong>' + jEl.attr('data-label-title') + '</strong><br>' + jEl.attr('data-duration-string');
			const categoryCssClass = jEl.attr('data-category-color');
			jEl.tooltip({
				html: true,
				container: false,
				title: title
			}).on('show.bs.tooltip', function () {
				jEl.tooltip().data('bs.tooltip')
					.tip()
					.addClass('o_videotask_tooltip')
					.addClass(categoryCssClass);
			})
		});
	});
	</script>
	#end
	
	#if($r.isTrue($enableDisableCategories))
	<script>
	"use strict";
	jQuery(function() {
		const videoElement = jQuery('#o_so_vid${videoElementId}');
		const player = videoElement.data('player');
		var currentSegmentIndex = findSegmentIndex(player.media.currentTime);
		
		player.media.addEventListener('timeupdate', function() {
			var startSegment = false;
			var endSegment = false;
			const segmentIndex = findSegmentIndex(player.media.currentTime);
			const findSegment = segmentIndex >= 0;

			jQuery('#o_videotask_categories>button').each(function(index, el) {
				if(el.disabled && findSegment) {
					startSegment = true;
				} else if(!el.disabled && !findSegment) {
					endSegment = true;
				}
				el.disabled=!findSegment;
			});
			
			const changeOfSegment = (segmentIndex >= 0 && segmentIndex != currentSegmentIndex);
			if(endSegment || changeOfSegment) {
				jQuery('#o_videotask_start_message').addClass('hide').removeClass('show');
				jQuery('#o_videotask_messages').addClass('hide').removeClass('show');
				jQuery('#o_videotask_categories>button>i').remove();
			}
			if(startSegment || changeOfSegment) {
				jQuery('#o_videotask_start_message').addClass('show').removeClass('hide');
				jQuery('#o_videotask_messages').addClass('hide').removeClass('show');
			}
			if(segmentIndex >= 0) {
				currentSegmentIndex = segmentIndex;
			}
		});
		
		function findSegmentIndex(time) {
			var segmentIndex = -1;
			jQuery('#o_videotask_segments>.o_video_me_segment').each(function(i, el) {
				const jEl = jQuery(el); 
				const start = parseFloat(jEl.attr('data-start'));
				const duration = parseFloat(jEl.attr('data-duration'));
				const index = parseInt(jEl.attr('data-index'));
				if(start >= 0 && time >= start && time <= (start + duration)) {
					segmentIndex = index;
				}
			});
			return segmentIndex;
		}
	});
	</script>
	#end
</div>