<div class="form-group row clearfix">
	$r.render("start", "label", "col-xs-3")
	<div class="col-xs-4">
		<div class="o_video_segment_start" style="width: 45%; display: inline-block;">
			$r.render("start")
			#if ($f.hasError("start"))
			<div>$r.render("start", "error")</div>
			#end
		</div>
		<div style="width: 5%; display: inline-block; text-align: center; vertical-align: top; line-height: 32px;">-</div>
		<div class="o_video_segment_end" style="width: 45%; display: inline-block; float: right;">
			$r.render("end")
			#if ($f.hasError("end"))
			<div>$r.render("end", "error")</div>
			#end
		</div>
	</div>
	$r.render("duration", "label", "col-xs-3")
	<div class="col-xs-2 o_video_segment_duration">
		$r.render("duration")
		#if ($f.hasError("duration"))
		<div>$r.render("duration", "error")</div>
		#end
	</div>
	<div class="o_form_example help-block col-xs-offset-10 col-xs-2">$r.render("duration", "example")</div>
</div>

<div class="form-group row clearfix">
	$r.render("category", "label", "col-xs-3")
	<div class="col-xs-9">$r.render("category")</div>
</div>

#if ($categoryOpen)
<div class="form-group row clearfix">
	<div class="col-xs-offset-3 col-xs-9">
		<div class="o_categories">
			#if ($categoriesAvailable)
			<ul class="o_category_list">
				#foreach ($category in $categories)
				#set ( $selectedClass = "#if ($category.getId() == $categoryId) o_selected#{else} #end" )
				<li class="o_category_list_item $selectedClass" onclick="$f.ffXHREvent('categoryId', $category.getId())">
					<div class="o_video_colored_area o_color_cube ${category.getColor()}"></div>
					<div class="o_category_text">${category.getLabelAndTitle()}</div>
				</li>
				#end
			</ul>
			#else
			<span class="o_video_segment_category_placeholder">$r.translate("form.segment.noCategoryAvailableYet")</span>
			#end
			<div class="o_edit_categories">
				$r.render("editCategories")
			</div>
		</div>
	</div>
</div>
#end

<div class="form-group row clearfix">
	<div class="col-xs-offset-3 col-xs-9">
		$r.render("save") $r.render("cancel")
	</div>
</div>

<script>
	jQuery(() => {
		const start = jQuery('.o_video_segment_start input');
		const end = jQuery('.o_video_segment_end input');
		const duration = jQuery('.o_video_segment_duration input');

		const parseTimeToSeconds = (timeString) => {
			const parts = timeString.split(':');
			return (+parts[0]) * 3600 + (+parts[1]) * 60 + (+parts[2]);
		}

		const formatTime = (timeInSec, defaultTimeString) => {
			if (timeInSec <= 0) {
				return defaultTimeString;
			}
			return new Date(timeInSec * 1000).toISOString().substring(11, 19);
		}

		const updateDuration = () => {
			const startInSec = parseTimeToSeconds(start.val());
			const endInSec = parseTimeToSeconds(end.val());

			if (endInSec - startInSec > 0) {
				duration.val((endInSec - startInSec));
			}
		};

		const updateEnd = () => {
			const startInSec = parseTimeToSeconds(start.val());
			const durationInSec = parseInt(duration.val());
			const endTimeString = formatTime(startInSec + durationInSec, end.val());
			end.val(endTimeString);
		}

		start.on('keyup', updateDuration);
		end.on('keyup', updateDuration);
		duration.on('keyup', updateEnd);
	});
</script>