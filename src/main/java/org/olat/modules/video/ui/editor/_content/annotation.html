<div class="form-group row clearfix">
	$r.render("start", "label", "col-xs-3")
	<div class="col-xs-4">
		<div class="o_video_annotation_start" style="width: 45%; display: inline-block;">
			$r.render("start")
			#if ($f.hasError("start"))
			$r.render("start", "error")
			#end
		</div>
		<div style="width: 5%; display: inline-block; text-align: center; line-height: 32px;">-</div>
		<div class="o_video_annotation_end" style="width: 45%; display: inline-block; float: right;">
			$r.render("end")
			#if ($f.hasError("end"))
			$r.render("end", "error")
			#end
		</div>
	</div>
	$r.render("duration", "label", "col-xs-3")
	<div class="col-xs-2 o_video_annotation_duration">
		$r.render("duration")
		#if ($f.hasError("duration"))
		$r.render("duration", "error")
		#end
	</div>
	<div class="o_form_example help-block col-xs-offset-10 col-xs-2">$r.render("duration", "example")</div>
</div>
<div class="form-group row clearfix">
	$r.render("text", "label", "col-xs-3")
	<div class="col-xs-9">$r.render("text")</div>
</div>
<div class="form-group row clearfix">
	$r.render("color", "label", "col-xs-3")
	<div class="col-xs-9">$r.render("color")</div>
</div>
<div class="form-group row clearfix">
<!--	$r.render("fontSize", "label", "col-xs-3")-->
<!--	<div class="col-xs-7">$r.render("fontSize")</div>-->
<!--	<div class="col-xs-2">$r.render("fontSizeValue")</div>-->
<!--	<div class="o_form_example help-block col-xs-offset-10 col-xs-2">$r.render("fontSizeValue", "example")</div>-->
	$r.render("positionSize", "label", "col-xs-3")
	<div class="col-xs-9">
		<div style="display: inline-block;">$r.render("positionSize")</div>
<!--		$r.render("editPositionSize")-->
	</div>
</div>
<div class="form-group row clearfix">
	<div class="col-xs-offset-3 col-xs-9">
		$r.render("save") $r.render("cancel")
	</div>
</div>

<script>
	jQuery(() => {
		const start = jQuery('.o_video_annotation_start input');
		const end = jQuery('.o_video_annotation_end input');
		const duration = jQuery('.o_video_annotation_duration input');

		const parseTimeToSeconds = (timeString) => {
			const parts = timeString.split(':');
			return (+parts[0]) * 3600 + (+parts[1]) * 60 + (+parts[2]);
		}

		const formatTime = (timeInSec, defaultTimeString) => {
			if (timeInSec <= 0) {
				return defaultTimeString;
			}
			return new Date(timeInSec * 1000).toISOString().substring(11, 19);
		}

		const updateDuration = () => {
			const startInSec = parseTimeToSeconds(start.val());
			const endInSec = parseTimeToSeconds(end.val());

			if (endInSec - startInSec > 0) {
				duration.val((endInSec - startInSec));
			}
			return true;
		};

		const updateEnd = () => {
			const startInSec = parseTimeToSeconds(start.val());
			const durationInSec = parseInt(duration.val());
			const endTimeString = formatTime(startInSec + durationInSec, end.val());
			end.val(endTimeString);
		}

		start.on('keyup', updateDuration);
		end.on('keyup', updateDuration);
		duration.on('keyup', updateEnd);
	});
</script>