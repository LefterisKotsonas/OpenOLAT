<div class="o_page_run_code $blockLayoutClass">
<div class="o_page_run_code_box">
	<div class="o_code_content_area">
		<div id="$.getCId()_cont" #if($height && !$expanded) style="height: $height; overflow: auto;" #end>
			<div class="o_code_scrollable_content">
				#if($lineNumbersEnabled)
				<div class="o_code_line_numbers">
					#foreach($lineNumber in $lineNumbers)
					<div class="o_code_line_number">
						<span class="o_code_line_number_span text-muted">$lineNumber</span>
					</div>
					#end
				</div>
				#end
				<pre><code id="$r.getCId()_code"
						   class="#if($codeLanguage) language-$codeLanguage #end #if($lineNumbersEnabled) o_line_numbers_enabled #end">$content</code></pre>
			</div>
		</div>
	</div>
	<div id="$r.getCId()_overlay" class="o_button_overlay"></div>
	<script>
		"use strict";
		function copyToClipboard(selector) {
			navigator.clipboard.writeText(jQuery(selector).text() + '\n');
		}

		function codeCopiedNotification(anchorDiv) {
			anchorDiv.title = '$r.translate("code.copied")';
			const anchor = jQuery(anchorDiv);
			const icon = anchor.find('i.o_icon');
			icon.removeClass('o_icon_copy');
			icon.addClass('o_icon_check');
			setTimeout(() => {
				anchorDiv.title = '$r.translate("code.copy.to.clipboard")';
				icon.removeClass('o_icon_check');
				icon.addClass('o_icon_copy');
			}, 2000);
		}

		function adjustToScrollbars(scrollableElement) {
			const horizontalScrollbarVisible = scrollableElement.scrollWidth > scrollableElement.clientWidth;
			if (horizontalScrollbarVisible) {
				const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
				if (isSafari) {
					scrollableElement.style.overflowX = 'scroll';
				}
			}
		}

		jQuery(function() {
			const codeElement = document.getElementById('$r.getCId()_code');
			const containerElement = document.getElementById('$r.getCId()_cont');
			const overlayElement = document.getElementById('$r.getCId()_overlay');
			hljs.highlightElement(codeElement);
			const cssClasses = Array.from(codeElement.classList).filter((c) => c.startsWith('language-'));
			if (cssClasses.length > 0) {
				const languageClassParts = cssClasses[0].split('-');
				if (languageClassParts.length > 1) {
					const languageName = languageClassParts[1];
					let languageLabel = languageName;
					if (languageName === 'plaintext') {
						languageLabel = '$r.translate("code.plaintext")';
					}
					overlayElement.innerHTML =
						'<a href="javascript:;" ' +
						'   title="$r.translate('code.copy.to.clipboard')" ' +
						'   onclick="copyToClipboard(\'#$r.getCId()_code\'); codeCopiedNotification(this); this.blur();">' +
						'  <i class="o_icon o_icon_copy"> </i> ' + languageLabel + '</a>';
				}
			}
			setTimeout(function() {
				adjustToScrollbars(containerElement);
			}, 0);
		});
	</script>
</div>
#if($height && $allowExpand)
<div class="o_page_run_code_expand o_expand_ctrl">
	<div class="o_button_group">
		$r.render("expandCollapseButton")
	</div>
</div>
#end
</div>