<div id="$r.getCId()" class="o_page_run_gallery $blockLayoutClass">
	#set($bottomPaddingClass = "")
	#if($showPagination)
		#set($bottomPaddingClass = "o_bottom_padding_for_pagination")
	#end
	<div class="o_gallery_header">
		<div class="o_gallery_title">$r.escapeHtml($title)</div>
		#if($showTopNavButtons)
		<div class="o_gallery_buttons">
			<div id="o_swiper_button_prev_$r.getCId()" class="swiper-button-prev"></div>
			<div id="o_swiper_button_next_$r.getCId()" class="swiper-button-next"></div>
		</div>
		#end
	</div>
	#if($showSideNavButtons)
	<div class="o_gallery_images_with_side_nav">
	<div id="o_swiper_button_prev_$r.getCId()" class="swiper-button-prev"></div>
	#end
	<div id="o_swiper_$r.getCId()" class="swiper o_gallery_images">
		<div class="swiper-wrapper">
			#foreach($galleryImageItem in $galleryImageItems)
				<div class="swiper-slide $bottomPaddingClass">
					<img src="$mapperUrl/${galleryImageItem.id()}">
					#if($showTitleAndDescription)
					<div class="o_title_and_description">
						<div class="o_title">
							$galleryImageItem.title()
						</div>
						<div class="o_description">
							$galleryImageItem.description()
						</div>
					</div>
					#end
				</div>
			#end
		</div>
		<div class="swiper-button-prev"></div>
		<div class="swiper-button-next"></div>
		<div class="swiper-pagination"></div>
	</div>
	#if($showSideNavButtons)
	<div id="o_swiper_button_next_$r.getCId()" class="swiper-button-next"></div>
	</div>
	#end
	#if($showThumbnails)
	<div id="o_swiper_thumbs_$r.getCId()" class="swiper o_gallery_thumbs">
		<div class="swiper-wrapper">
			#foreach($galleryImageItem in $galleryImageItems)
			<div class="swiper-slide">
				<img src="$mapperUrl/${galleryImageItem.id()}">
			</div>
			#end
		</div>
	</div>
	#end
</div>
<script>
	"use strict";
	var imageGallery = new Swiper('#o_swiper_$r.getCId()', {
		#if($showRows)
		grid: {
			rows: $rows,
		},
		#end
		slidesPerView: $columns,
		slidesPerGroup: $rows,
		spaceBetween: 10,
		breakpointBase: 'container',
		navigation: {
			prevEl: '#o_swiper_button_prev_$r.getCId()',
			nextEl: '#o_swiper_button_next_$r.getCId()',
			disabledClass: 'o_swiper_button_disabled'
		},
		#if($showPagination)
		pagination: {
			el: '.swiper-pagination',
			clickable: true
		},
		#end
	});

	#if($showThumbnails)
	var thumbsGallery = new Swiper('#o_swiper_thumbs_$r.getCId()', {
		centeredSlides: true,
		spaceBetween: 10,
		slidesPerView: 'auto',
		slideToClickedSlide: true,
		touchRatio: 0.2,
	});

	imageGallery.controller.control = thumbsGallery;
	thumbsGallery.controller.control = imageGallery;
	#end

	#if($showRows)
	var maxHeightPerRow = new Array($rows).fill(0);
	jQuery(function() {
		jQuery('#o_swiper_$r.getCId() .swiper-slide').each(function(i, obj) {
			var rowIndex = i % $rows;
			var height = obj.clientHeight;
			maxHeightPerRow[rowIndex] = Math.max(height, maxHeightPerRow[rowIndex]);
		});
		var totalHeight = 0;
		for (var row = 0; row < $rows; row++) {
			if (row > 0) {
				totalHeight += 10;
			}
			totalHeight += maxHeightPerRow[row] - 24;
		}
		var swiper = document.getElementById('o_swiper_$r.getCId()');
		swiper.setAttribute('style', `height: ${totalHeight}px;`);
	});
	#end
</script>